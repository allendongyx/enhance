Chrome 插件产品文档：网页剪藏工具 (KaKa Clipper)

1. 文档信息
- 文档版本：1.1
- 文档日期：2025 年 9 月 26 日
- 产品名称：KaKa Clipper
- 产品类型：Google Chrome 浏览器扩展
- 目标平台：Chrome 浏览器（支持 Manifest V3 规范）
- 文档目的：定义产品的功能需求、用户体验、技术要求和开发指南，帮助开发团队实现一个高效的网页剪藏和管理工具。本版本更新存储方案为 chrome.storage.local 结合 unlimitedStorage 权限，实现无限本地存储。
  
2. 产品概述
2.1 产品描述
KaKa Clipper 是一个 Chrome 浏览器扩展，旨在帮助用户快速捕获和保存网页正文内容为 PDF 文件，并提供便捷的管理功能。用户可以轻松地将感兴趣的网页内容“剪藏”下来，避免浏览器标签过多或内容丢失的问题。该扩展强调简单易用、隐私保护和高效存储，适用于学生、研究人员、内容创作者等需要频繁保存网页的用户。

2.2 产品目标
- 核心价值：简化网页内容保存流程，提高用户生产力。
    
3. 功能需求
3.1 核心功能
3.1.1 剪藏功能（Clipping）
- 描述：用户在当前浏览器标签页中，捕获网页的正文内容（排除广告、侧边栏等无关元素），并将其转换为 PDF 文件保存。
- 触发方式：
  - 点击浏览器工具栏上的扩展图标。
  - 使用键盘快捷键（例如 Ctrl+Shift+C，可配置）。
  - 右键菜单选项：“剪藏当前页面”。
- 详细流程：
  1. 用户触发剪藏。
  2. 扩展注入内容脚本（content script），提取网页正文（使用 Readability.js 或类似库解析 DOM，获取标题、作者、正文段落、图像等）。
  3. 生成 PDF：使用 jsPDF 库或其他客户端 PDF 生成工具，将提取内容渲染为 PDF（包括文本格式、图像嵌入、超链接保留）。
  4. 自动命名：默认文件名为“网页标题_日期.pdf”（例如 “How to Build Extensions_2025-09-26.pdf”）。
  5. 用户若不满意默认名称，可以重命名
  5. 保存：存储在 chrome.storage.local 中，作为 Blob 数据（结合 unlimitedStorage 权限，支持无限存储）。
  6. 反馈：显示成功通知（Toast 消息），并可选预览 PDF。
- 边缘案例：
  - 如果网页无正文（纯图像页），提示“无法提取内容”。
  - 支持多语言网页（UTF-8 编码）。
  - PDF 大小限制：若超过 5MB，压缩或警告用户（但存储无上限）。
- 输入/输出：
  - 输入：当前网页 URL 和 DOM。
  - 输出：PDF 文件数据，包含元数据（剪藏时间、原 URL）。
    
3.1.2 管理功能（Management）
- 描述：在浏览器右侧弹出侧边栏，显示所有剪藏的 PDF 列表，支持查看、删除、重命名和拖拽到文件上传输入框。
- 触发方式：
  - 点击扩展图标，选择“打开管理面板”。
  - 使用快捷键（例如 Ctrl+Shift+M）。
- 详细流程：
  1. 弹出侧边栏：使用 Chrome sidePanel API（Manifest V3 支持），宽度约 300-400px，高度全屏。
  2. 列表展示：按剪藏时间降序（最新在上）显示 PDF 项，每项包括：
    - 缩略图（PDF 第一页预览，使用 pdf.js 库生成）。
    - 文件名。
    - 剪藏时间。
    - 原网页 URL（可点击跳转）。
    - 大小（KB/MB）。
  3. 操作：
    - 重命名：点击编辑图标，输入新名称，保存。
    - 删除：选中项，点击删除按钮，确认后移除（支持批量删除）。
    - 查看：点击列表项，在侧边栏内预览 PDF（使用 pdf.js 渲染），或下载到本地。
    - 拖拽：将列表项设置为 draggable，在 dragstart 事件中从存储获取 Blob，创建 File 对象，支持拖到网页文件上传框。
    - 搜索：顶部搜索框，按文件名或 URL 过滤列表。
    - 排序：可选切换为名称排序或大小排序。
  4. 关闭侧边栏：点击关闭按钮或外部区域。
- 边缘案例：
  - 列表为空：显示“暂无剪藏内容，开始剪藏吧！”。
  - 存储满：提示用户清理或导出（实际依赖设备空间）。
- 输入/输出：
  - 输入：用户操作（如删除、重命名、拖拽）。
  - 输出：更新后的列表和存储数据。
    
3.2 辅助功能
- 设置页面：扩展弹出页（popup.html），包括：
  - 启用/禁用自动剪藏。
  - 自定义快捷键。
  - 导出所有 PDF 为 ZIP 文件。
  - 清空所有数据（需二次确认）。
- 通知系统：使用 chrome.notifications API 发送剪藏成功/失败消息。
- 更新日志：在设置中显示版本更新信息。
  
3.3 非功能需求
- 性能：
  - 剪藏时间 < 5 秒（针对中等大小页面）。
  - 侧边栏加载 < 1 秒。
- 兼容性：
  - Chrome 版本：最新稳定版（2025 年标准）。
  - 支持桌面 Chrome，不支持移动版。
- 安全性：
  - 所有数据本地存储，不上传服务器。
  - 权限：content_scripts、storage、downloads、sidePanel、unlimitedStorage。
  - 避免注入恶意代码。
- 可用性：
  - UI 主题：匹配 Chrome 暗/亮模式。
  - 国际化：支持英文/中文（默认根据浏览器语言）。
- 可扩展性：
  - 未来添加：云同步（需用户授权）、标签分类、OCR 文本提取。
    
4. 用户界面与体验设计
4.1 UI 组件
- 工具栏图标：剪刀形状图标，点击弹出菜单（剪藏、管理、设置）。
- 侧边栏：
  - 顶部：标题 “我的剪藏”、搜索框。
  - 中部：列表（使用 HTML ul/li，CSS 网格布局，支持 draggable 属性）。
  - 底部：按钮（导出、清空）。
- 弹出通知：简洁 Toast，绿色成功/红色失败。
- 设计原则：Material Design 风格，响应式布局，确保在不同屏幕分辨率下正常显示。
  
4.2 用户流程图
- 剪藏流程：
  1. 打开网页 → 点击图标 → 提取内容 → 生成 PDF → 保存并通知。
- 管理流程：
  1. 点击管理 → 加载列表 → 操作（重命名/删除/拖拽） → 更新视图。
    
5. 技术要求
5.1 架构
- Manifest 文件：V3 版本，声明 permissions、content_scripts、side_panel。特别包括 "unlimitedStorage" 以移除存储限额。
- 文件结构：
  - manifest.json
  - background.js（后台脚本，处理通知）。
  - content.js（内容脚本，提取网页）。
  - sidebar.html/js（侧边栏界面）。
  - popup.html/js（设置弹出页）。
- 依赖库：
  - Readability.js：提取正文。
  - jsPDF：生成 PDF。
  - pdf.js：预览 PDF。
  - （所有库本地打包，无外部 CDN）。
    
5.2 数据存储
- 使用 chrome.storage.local（结合 unlimitedStorage 权限，实现无限本地存储，受设备磁盘空间限制）。
- 数据格式：数组对象 [{id: uuid, name: string, data: Blob, timestamp: date, url: string}]，存储为二进制 Blob 以支持大文件和拖拽功能。
- 存储操作：使用 chrome.storage.local.set/get，拖拽时从 Blob 创建 File 对象，无需实际磁盘文件。
  
5.3 开发工具
- 语言：JavaScript (ES6+)、HTML5、CSS3。
- 测试：Chrome 扩展调试工具、Jest 单元测试。
- 打包：Webpack 或手动 zip。
  
6. 测试计划
- 单元测试：PDF 生成、存储操作（包括大文件测试）。
- 集成测试：端到端流程（剪藏 → 管理，包括拖拽到上传框）。
- 用户测试：招募 10 名 beta 用户，反馈 UI/性能。
- 边界测试：大网页、特殊字符文件名、无网络环境、大量文件存储（模拟 100+ PDF）。
  
7. 部署与维护
- 发布：上传 Chrome Web Store，版本控制使用 Git。
- 更新机制：自动更新，推送新版本。
- 支持：提供 GitHub issues 或 email 支持。
- 未来 roadmap：
  - V1.1：添加分享功能。
  - V2.0：集成 AI 总结 PDF 内容、自定义云同步。
    
此文档为更新版本，聚焦 unlimitedStorage 方案。如果需要代码实现、原型图或进一步细节，请提供更多信息。